:::tip
    * Lors de l'installation du plug-in de gravure, veillez à être connecté à Internet, assurez-vous que votre ordinateur de contrôle est correctement connecté à Internet.
    * Si vous avez déjà installé, il n'est pas nécessaire de réinstaller.
:::


### Démarrer la gravure

    :::warning Avertissement
       * **Non fly-ordinateur de contrôle** : Veuillez impérativement exécuter le code suivant pour installer les paquets de dépendances nécessaires à la gravure du firmware ! Sinon, le firmware ne pourra pas être gravé !
       ```
      cd && git clone https://github.com/Arksine/katapult.git
       ```
      <ImageView image={require('@site/docs/General/dfu-flash/img/get_katapult.webp').default} size="80%" align="center" />
    :::
    * Utilisez la commande ci-dessous pour rechercher votre ID de périphérique, un ID similaire à celui de l'image ci-dessous doit apparaître (remarque : l'ID de l'image est fourni à titre indicatif, chaque carte mère a un ID différent)

        ```bash
        ls /dev/serial/by-id/*
        ```
        <ImageView image={require('@site/docs/General/dfu-flash/img/2040.webp').default} size="80%" align="center" />


    * Pour graver le firmware, utilisez la commande ci-dessous, assurez-vous d'avoir compilé le firmware, et remplacez `<votre ID de carte mère>` par l'ID obtenu à l'étape précédente

        ```bash
        ~/klippy-env/bin/python ~/katapult/scripts/flashtool.py -d /dev/serial/by-id/<votre ID de carte mère>
        ```
    Le système `fast` utilise cette commande pour graver, remplacez `<votre ID de carte mère>` par l'ID obtenu à l'étape précédente

            ```bash
            python ~/katapult/scripts/flashtool.py -d /dev/serial/by-id/<votre ID de carte mère>
            ```
    * Voici une référence
        <ImageView image={require('@site/docs/General/dfu-flash/img/kaulut7.webp').default} size="100%" align="center" />

    * Référence après la gravure
        <ImageView image={require('@site/docs/General/dfu-flash/img/katapult3.webp').default} size="100%" align="center" />

## Mise à jour du firmware

<Tabs>
    <TabItem value="w" label="Mise à jour du firmware USB" default>
    * Utilisez la commande suivante pour rechercher l'ID de votre carte mère, l'ID similaire à celui de l'image ci-dessous doit apparaître (remarque : l'ID de l'image est fourni à titre indicatif, chaque carte mère a un ID différent)

        ```bash
        ls /dev/serial/by-id/*
        ```
    :::tip Remarque
        L'ID `/dev/serial/by-id/usb-katapult_rp2040_E662549553642032-if00` de l'image correspond à l'ID de la carte mère.
    :::
        <ImageView image={require('@site/docs/General/dfu-flash/img/2040.webp').default} size="80%" align="center" />

    * La mise à jour du firmware USB nécessite de compiler le firmware le plus récent, puis d'exécuter la commande suivante, en remplaçant `<votre ID de carte mère>` par l'ID obtenu à l'étape précédente

        ```bash
        cd ~/klipper/ && make flash FLASH_DEVICE=<votre ID de carte mère>
        ```
       <ImageView image={require('@site/docs/General/dfu-flash/img/katapult5.webp').default} size="100%" align="center" />
    </TabItem>


    <TabItem value="l" label="Mise à jour du firmware CAN via pont">
    * Pour mettre à jour le firmware CAN via pont USB, il faut compiler le firmware le plus récent, puis exécuter la commande suivante pour réinitialiser dans Katapult. (L'ID de l'image ci-dessous est fourni à titre indicatif, veuillez utiliser l'ID dans votre fichier de configuration)
    :::tip Remarque
       * `<votre UUID CANBUS>` est l'UUID CANBUS de la carte mère dans votre fichier de configuration **printer.cfg**
    :::
        
        <br/>

        ```bash
        ~/klippy-env/bin/python3 ~/katapult/scripts/flashtool.py -i can0 -r -u <votre UUID CANBUS>
        ```
    :::tip Remarque
       * L'ID `f95cee90e1f9` de l'image ci-dessous correspond à l'UUID CANBUS de la carte mère.
    :::
        <ImageView image={require('@site/docs/General/dfu-flash/img/katapult6.webp').default} size="100%" align="center" />
    * Après avoir réinitialisé dans Katapult, utilisez la commande suivante pour rechercher votre ID de carte mère, un ID similaire à celui de l'image ci-dessous doit apparaître (remarque : l'ID de l'image est fourni à titre indicatif, chaque carte mère a un ID différent)

        ```bash
        ls /dev/serial/by-id/*
        ```
    :::tip Remarque
        L'ID `/dev/serial/by-id/usb-Klipper_stm32f072xb_43002C000951324757373520-if00` de l'image correspond à l'ID de la carte mère.
    :::
        <ImageView image={require('@site/docs/General/dfu-flash/img/katapult4.webp').default} size="80%" align="center" />

    * Assurez-vous que le nouveau firmware a été compilé avant d'exécuter la gravure. Remplacez `<votre ID de carte mère>` par l'ID obtenu à l'étape précédente

        ```bash
        cd ~/klipper/ && make flash FLASH_DEVICE=<votre ID de carte mère>
        ```
       <ImageView image={require('@site/docs/General/dfu-flash/img/katapult5.webp').default} size="100%" align="center" />
    </TabItem>

</Tabs>

## Méthode de correction si le mauvais firmware est flashé

* Éteignez la carte mère, réallumez-la, puis appuyez rapidement deux fois sur le bouton reset pour réactiver le mode de gravage.
* Ou réinstallez le firmware Katapult via l'ordinateur Windows/ordinateur de contrôle en suivant ce lien pour accéder à la section de gravage de katapult<Button variant="contained" disableElevation href="/docs/ProductDoc/MainBoard/fly-d/fly-d5/flash/bl#entrer_mode_de_gravage_dfu">Graver le firmware katapult</Button>
