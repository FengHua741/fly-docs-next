---
sidebar_position: 4
sidebar_label: klipper自動Z-OFFSET
---

# klipperインストールノズル衝突

:::info
この機能はBDセンサーのファームウェアバージョン(V1.1b、V1.2bより大きい、または2024年3月以降に購入されたもの)が必須です。それ以外の場合、外部ハードウェアツール(STlinkなど)を使用してファームウェアをBDセンサーに書き込む必要があります。

PEI(Whambamなど)でホーム操作を行う際には、ノズルを過度に加熱しないようにしてください。過度な熱はPEIに穴を開ける可能性があります。
:::

# その仕組み
* ノズルまたはベッドが衝突により停止した場合、BDセンサーが測定する距離データも停止し、その後BDセンサーはすぐに停止信号を出力します。
* G28の実行時に自動z_offset校正のプロセス：これはノズルがホーム操作中にベッドに接触した後、ゆっくりと上向きに移動してノズルがベッドから離れるまで設定され、この位置をz軸の0位置として設定します。

# 利点
* 自動z軸オフセット校正。
* 一方で、異なるフィラメントに対して手動でz軸オフセットを調整することができます。
* 温度ドリフトを克服します。
* 温度ドリフトはz軸オフセットを変えるかもしれませんが、BDセンサー付きのベッドマッピングの範囲は変わりません。つまり、温度が異なっても、ベッドマッピングは同じです。

# 使用方法

* `collision_homing`と`collision_calibrate`を[BDセンサー]セクションに追加します。
``` bash
[BDセンサー] 
collision_homing:0 # これを1に設定すると、ノズル衝突センシングによるホーム機能を有効にします。無効にするには0に設定します。 ノズル衝突センシングによるホーム機能を有効にするには、それを1に設定します。無効にするには、それを0に設定します。
                   
collision_calibrate:0 # これを1に設定すると、ノズル衝突センシングによる自動BDセンサー校正を有効にします。無効にするには0に設定します。 # ノズル衝突センシングによる自動BDセンサー校正を有効にするには、それを1に設定します。無効にするには、それを0に設定します。
# これにより、M102 S-6コマンドを送信する前に、ノズルをベッド上で手動で移動したり、紙テストを行ったりする必要はありません。
```

* センシティビティは速度に依存します。速度が遅いほど、センシティビティが高いので、Z軸の速度、homing_speed(ホーム速度)およびsecond_homing_speed(2回目のホーム速度)を2から5の範囲に設定する必要があります。

:::info
ノズルはきれいに掃除するか、またはフィラメント残渣を柔らかくするために加熱する必要があります。
速度を過度に高く設定しないでください。速度が高すぎると、ホットエンドやプリントベッドが損傷する可能性があります。一方、速度が低すぎると、実際にはプリントベッドに接触していないにもかかわらず空中でトリガーされる可能性があります。
:::

# 参照構成
``` bash
[ステッパー_z]
endstop_pin: probe:z_virtual_endstop
#position_endstop: 0.0
position_max: 250
homing_speed: 5
second_homing_speed:3
homing_retract_dist:5
homing_retract_speed:2
```

:::tip
`z_hop`(Z軸リターン高さ)および`homing_retract_dist`(リターン距離)は5以上であるべきです。
:::
# 参照構成

```bash
[安全_Z_ホーム]
z_hop: 5 

[ステッパー_z]
homing_retract_dist:5
```
```bash
[BDセンサー] 
...
speed:3 # この速度はZ軸傾斜とPROBE_ACCURACYコマンドのみに適用されます。 # この速度はZ軸傾斜とPROBE_ACCURACYコマンドのみに適用されます。
...

```
:::tip ヒント
参照構成`zero_reference_position`
:::

``` bash
[ベッドメッシュ]
horizontal_move_z:1 # 0.7~1.0mmが推奨されます 推奨値は0.7~1.0ミリメートルです。
zero_reference_position: 150, 160 # この値は、safe_z_homeセクション内のhome_xy_positionと同じ座標に設定する必要があります。
....
```

# ホームテスト
約10回の`G28 Z`コマンドを送信し、その後の各`G28 Z`コマンド送信後のコンソール出力を確認してみてください。
``` bash
G28 Z
```
<Button variant="contained" disableElevation component="a" rel="noopener" href="https://www.youtube.com/watch?v=RuPoXbrSPDc">デモンストレーションビデオ</Button>
