---
sidebar_position: 1
---

# 簡介
apls 圧力モジュールは、ADS131M02をベースにした圧力センシングソリューションで、主に3Dプリンターの自動Z軸ホーム（Home）とメッシュベッドレベル調平の開発に特化しています。高感度な圧力検出とリアルタイム信号処理により、モジュールはプリントヘッドとメッシュベッドの接触状態を正確に感知し、ミリ単位の調平精度を実現します。これにより、従来の機械式リミットスイッチ校正の誤差を解消し、初層プリントの成功確率を大幅に向上させます。

## apls 圧力モジュールの使用方法

### 推奨されるティッシュ機能との併用
apls 圧力モジュールを使用する際には、ノズルの清掃を確保するためにティッシュ機能との併用を推奨します。これにより、調平の精度と安定性が向上します。

#### XH2.54 4Pin 接線図
モジュールはメインボードのUARTポートまたは拡張ボードのUARTポートに直接挿入できます。UARTポートがない場合、メインボード上の2つのピンを探し、電源ラインの正負極に注意してください。
<ImageView image={require('@site/docs/ProductDoc/ExtensionBoard/fly-apls/img/uart.webp').default} size="100%" align="center" />

### インストール時の注意事項
1. モジュールがしっかりと固定されていることを確認し、印刷中の振動による接触不良を防ぎましょう。
2. 接線が正しいことを確認し、接線エラーによるモジュールの不具合を避けましょう。
3. 最初の使用前に複数回の調平テストを行い、モジュールの感度と精度が期待通りであることを確認してください。

## ステータスLED表示
- **電源投入時**: 緑色のフレーム内のステータスLEDが点灯している場合、モジュールが正常に動作しています。
- **トリガー時**: 緑色のフレーム内のステータスLEDが消灯している場合、モジュールがトリガー状態です。
<ImageView image={require('@site/docs/ProductDoc/ExtensionBoard/fly-apls/img/LED.webp').default} size="20%" align="center" />

### ステータスLEDのトラブルシューティング
- LEDが点灯しない場合、電源接続が正しいか確認してください。
- LEDが点滅し続ける場合は、モジュールが異常信号を検出した可能性があります。プローブが異物で詰まったり損傷していないか確認してください。

## 設定ガイド
既存の設定ファイル内の `probe` および `ホーム` 部分を置き換えて、以下の設定を追加してください：

### 設定ファイル例
以下は推奨される設定ファイルの内容です。実際のニーズに応じて調整してください：

```cfg
[homing_override]
axes: xyz
set_position_z:10
gcode:
       G91
       G1 Z10 F3000
       G90
        SET_PIN PIN=_probe_ready VALUE=0
        ## _LIFT_Z
       {% set home_all = 'X' not in params and 'Y' not in params and 'Z' not in params %}

       {% if home_all or 'X' in params %}
            G28 X
       {% endif %}

       {% if home_all or 'Y' in params %}
            G28 Y
            G0 X{printer.toolhead.axis_maximum.x / 2} Y{printer.toolhead.axis_maximum.y / 2} F6000
       {% endif %}

       {% if home_all or 'Z' in params %}
       # 同時にeddyと圧力センサーを使用する場合、次の行のコメントアウトを解除してください
            #SET_PIN PIN=_probe_ready VALUE=1 
            G28 Z 
            #SET_PIN PIN=_probe_ready VALUE=0
            G1 Z10 F3000           
        {% endif %}

[output_pin _probe_ready]
pin: PA9
shutdown_value: 0

[probe]
pin: PA10
x_offset: 0                  # X軸-センサーのノズルからのオフセット
y_offset: 0               # Y軸-センサーのノズルからのオフセット
z_offset:0                # Z軸-センサーのノズルからのオフセット
speed: 8                 # 調平速度
samples: 3                   # サンプル回数
samples_result: median       # 取得値の決定方法（デフォルトはmedian-中央値）
sample_retract_dist: 2     # 調平時の引き戻し距離
samples_tolerance: 0.05      # サンプル許容範囲（許容範囲が小さい場合、サンプル回数が増えます）
samples_tolerance_retries: 3 # 許容範囲超過時のリトライ回数
activate_gcode:
           G4 P500
           SET_PIN PIN=_probe_ready VALUE=1
deactivate_gcode:
           SET_PIN PIN=_probe_ready VALUE=0  
```

### Z Offset 値の調整に関する参考
以下のコマンドを使用して `z-offset` を調整します：
```gcode
PROBE_CALIBRATE
```

- `z-offset` 値を調整する前に、Klipperのドキュメントにあるチュートリアル「Paper Test」を参考にしてください：[Paper Test](https://www.klipper3d.org/Bed_Level.html#the-paper-test)

:::info 注意
- 圧力モジュールをZ軸リミットとして使用する場合、既存の `endstop_pin` 設定を `endstop_pin: probe:z_virtual_endstop` に置き換えてください。
:::
