---
sidebar_position: 4
sidebar_label: Автоматическая Z-OFFSET для Klipper
---

# Установка соприкосновения сопла в Klipper

:::info
Для этой функции требуется версия прошивки датчика BD (вы можете получить эту версию, отправив команду M102 S - 1, а не версию аппаратного обеспечения на датчике) V1.1b, больше V1.2b или версия, купленная после марта 2024 года. В противном случае вам потребуется использовать внешний аппаратный инструмент (например, STlink) для прошивки прошивки в датчик BD.

При выполнении операции возврата с использованием мягкого PEI (например, Whambam), не нагревайте сопло слишком сильно, иначе высокая температура может оставить отверстия на PEI.
:::

# Как это работает
* Если сопло или поверхность стола останавливаются из-за столкновения, данные о расстоянии, измеренные датчиком bd, также перестанут изменяться, а затем датчик bd быстро выдаст сигнал остановки.
* Процесс автоматической калибровки z_offset при выполнении G28: он может быть активирован, когда сопло касается поверхности стола во время возврата - затем медленно поднимается до тех пор, пока сопло только что не оторвется от поверхности стола - и эта позиция устанавливается как 0 для оси z.

# Преимущества
* Автоматическая калибровка смещения оси z.
* В то же время вы все еще можете вручную регулировать смещение оси z для разных нитей.
* Преодоление температурного дрейфа.
* Температурный дрейф изменяет смещение оси z, но не изменяет диапазон карты сетки поверхности стола с датчиком BD. Это означает, что даже при разных температурах сетка поверхности стола остается одинаковой.

# Как использовать

* Добавьте `collision_homing` и `collision_calibrate` в раздел [BDsensor].
``` bash
[BDsensor] 
collision_homing:0 # Установите 1, чтобы включить возврат с функцией обнаружения столкновения сопла. Отключите, установив 0.
                   
collision_calibrate:0 # Установите 1, чтобы включить автоматическую калибровку датчика BD с функцией обнаружения столкновения сопла. Отключите, установив 0.
# Это означает, что нам не нужно вручную перемещать сопло на столе и проводить тест с бумагой перед отправкой команды калибровки M102 S - 6.
```

* Чувствительность зависит от скорости, чем медленнее скорость, тем выше чувствительность, поэтому вам нужно отрегулировать скорость оси Z, скорость возврата (homing_speed) и вторую скорость возврата (second_homing_speed) должны быть в диапазоне от 2 до 5.

:::info
Сопло должно быть очищено или нагрето, чтобы смягчить остатки материала.
Пожалуйста, не устанавливайте скорость слишком высокой или слишком низкой. Если скорость слишком высока, это может повредить ваш горячий конец или печатную поверхность; а если скорость слишком низкая, это может вызвать срабатывание в воздухе, фактически сопло не касается печатной поверхности.
:::

# Референсная конфигурация
``` bash
[stepper_z]
endstop_pin: probe:z_virtual_endstop
#position_endstop: 0.0
position_max: 250
homing_speed: 5
second_homing_speed:3
homing_retract_dist:5
homing_retract_speed:2
```

:::tip
`z_hop` (Высота отскока оси Z) и `homing_retract_dist` (Расстояние отката при возврате в ноль) должны быть больше или равны 5.
:::
# Референсная конфигурация

```bash
[safe_z_home]
z_hop: 5 

[stepper_z]
homing_retract_dist:5
```
```bash
[BDsensor] 
...
speed:3 # Эта скорость работает только для наклона оси Z и команды PROBE_ACCURACY. #
...

```
:::tip Подсказка
Референсная конфигурация `zero_reference_position`
:::

``` bash
[bed_mesh]
horizontal_move_z:1 # Рекомендуется использовать 0,7 - 1,0 мм.
zero_reference_position: 150, 160 # Установите это значение таким же, как home_xy_position в разделе  ## Установите это значение в тех же координатах, что и home_xy_position в разделе safe_z_home.
....
```

# Тестирование возврата
Отправьте команду `G28 Z` примерно 10 раз, а затем проверьте, является ли выходная информация на консоли стабильной после каждого отправления команды `G28 Z`.
``` bash
G28 Z
```
<Button variant="contained" disableElevation href="https://www.youtube.com/watch?v=RuPoXbrSPDc">Видео демонстрации</Button> 