---
sidebar_position: 4
sidebar_label: Автоматическая Z-OFFSET для Marlin
---

# Коллизионное обнаружение для Marlin

:::info
Для этой функции требуется версия прошивки BD-датчика (вы можете получить ее, отправив команду M102 S-1, а не версию аппаратного обеспечения на датчике)
V1.1b, больше V1.2b или купленную после марта 2024 года. В противном случае вам потребуется использовать внешний аппаратный инструмент (например, STlink) для прошивки BD-датчика.
:::

# Как это работает

* Автоматическая калибровка смещения оси Z при выполнении G28: может быть активирована при возвращении в исходное положение (когда сопло касается платформы) - затем медленно перемещается вверх, пока сопло только что оторвется от платформы - эта позиция устанавливается как 0 точки оси Z.

# Преимущества

* Автоматическая калибровка смещения оси Z.
* При этом вы все еще можете вручную регулировать смещение оси Z для разных типов нити.
* Преодоление температурного дрейфа.
* Температурный дрейф изменяет смещение оси Z, но не изменяет диапазон карты сетки поверхности кровати с BD-датчиком. Это означает, что даже при разных температурах сетка поверхности кровати остается одинаковой.

:::info Подсказка
Код для этой функции находится в списке запросов на извлечение из официального репозитория Marlin GitHub: https://github.com/MarlinFirmware/Marlin/pull/27243
Поэтому используйте следующий код Marlin: https://github.com/markniu/MarlinPULL/tree/bugfix-2.1.x
:::

# Как использовать

Включите `BD_SENSOR` и добавьте `#define BD_SENSOR_CONTACT_PROBE` в `configuration.h`
Это должно выглядеть следующим образом:

``` bash
#define BD_SENSOR
#if ENABLED(BD_SENSOR)
  #define BD_SENSOR_PROBE_NO_STOP // Проводить зондирование кровати без остановки в каждой точке зондирования
  #define BD_SENSOR_CONTACT_PROBE // Использует обнаружение столкновения сопла для зондирования во время возвращения в исходное положение
#endif
```
* Увеличьте скорость зондирования в configuration.h.

* Чувствительность зависит от скорости, поэтому вам нужно настроить скорость оси Z.
* скорость возвращения в исходное положение (homing_speed) и вторая скорость возвращения в исходное положение (second_homing_speed) должны быть в диапазоне от 3 до 10, это скорость подачи зонда оси Z.
* Например:
``` bash
 #define Z_PROBE_FEEDRATE_FAST  (5*60)
 #define Z_PROBE_FEEDRATE_SLOW  (5*60)
```
* Увеличьте подъем оси Z при возвращении в исходное положение в Configuration_adv.h до более чем 4 миллиметров.
``` bash
#define HOMING_BUMP_MM      { 5, 5, 5 } 
```
# Тестирование возвращения в исходное положение
* Пошлите команду `G28 Z` примерно 10 раз или используйте команду `M48`, чтобы увидеть, является ли она стабильной.

<Button variant="contained" disableElevation href="https://www.youtube.com/watch?v=DzmGyJNS9bY">Демонстрационное видео</Button> 