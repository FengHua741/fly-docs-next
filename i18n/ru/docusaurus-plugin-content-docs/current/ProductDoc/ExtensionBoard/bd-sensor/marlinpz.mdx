---
sidebar_position: 4
sidebar_label: Автоматическая смещение Z для Marlin
---

# Обнаружение столкновений в Marlin

:::info
Эта функция требует версии прошивки датчика BD (версию можно получить, отправив M102 S-1, а не по версии на самой плате). Версия должна быть V1.1b, больше V1.2b или устройство должно быть куплено после марта 2024 года. В противном случае вам нужно будет прошить датчик внешним инструментом (например, STlink).
:::

# Как это работает

* При выполнении G28 автоматически проводится калибровка смещения Z: может быть активирована при возврате домой (после контакта с платформой) — затем медленно поднимается, пока сопло только слегка не оторвется от платформы — и этот момент устанавливается как точка 0 Z.

# Преимущества

* Автоматическая калибровка смещения Z.
* Вы все еще можете вручную настроить смещение Z для разных нитей.
* Устраняет дрейф температуры.
* Дрейф температуры изменяет смещение Z, но не меняет диапазон сетки высоты платы с датчиком BD. Это означает, что даже при разной температуре сетка платы остается одинаковой.

:::info Подсказка
Код этой функции находится в списке pull request официального репозитория Marlin GitHub: https://github.com/MarlinFirmware/Marlin/pull/27243
Поэтому используйте следующий код Marlin: https://github.com/markniu/MarlinPULL/tree/bugfix-2.1.x
:::

# Как использовать

Включите `BD_SENSOR` и добавьте в `configuration.h` `#define BD_SENSOR_CONTACT_PROBE`
Оно должно выглядеть так:

``` bash
#define BD_SENSOR
#if ENABLED(BD_SENSOR)
  #define BD_SENSOR_PROBE_NO_STOP // Пробируем плату без остановки на каждом точке
  #define BD_SENSOR_CONTACT_PROBE // Используется сенсорный метод пробирования во время возврата домой
#endif
```
* В файле configuration.h увеличьте скорость зонда.

* Чувствительность зависит от скорости, поэтому вам нужно отрегулировать скорость Z.
* Скорость home и second_home должны находиться в диапазоне от 3 до 10, здесь указана скорость подачи Z-зонда.
* Например:
``` bash
 #define Z_PROBE_FEEDRATE_FAST  (5*60)
 #define Z_PROBE_FEEDRATE_SLOW  (5*60)
```
* В файле Configuration_adv.h увеличьте подъем при возврате домой выше 4 мм.
``` bash
#define HOMING_BUMP_MM      { 5, 5, 5 } 
```
# Тестирование возврата домой
* Отправьте около 10 команд `G28 Z` или используйте команду `M48`, чтобы проверить его стабильность.

<Button variant="contained" disableElevation component="a" rel="noopener" href="https://www.youtube.com/watch?v=DzmGyJNS9bY">Видео демонстрации</Button>
