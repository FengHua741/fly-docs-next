---
sidebar_position: 4
sidebar_label: Автоматическая корректировка Z-OFFSET в Marlin
---

# Сенсорный датчик столкновений в Marlin

:::info
Данная функция требует версии прошивки датчика BD (версию можно проверить отправкой команды M102 S-1, а не у hardware версию сенсора).
Версия должна быть V1.1b, выше V1.2b или датчик приобретён после марта 2024 года, иначе понадобится использование внешнего инструмента для прошивки, например STlink.
:::

# Как это работает

* Автоматическая калибровка Z-смещения при выполнении G28: может происходить при контакте с платформой (после завершения homing) — затем медленно поднимается до момента, когда сопло только слегка отрывается от поверхности — этот уровень устанавливается как точка 0 по Z.

# Преимущества

* Автоматическая калибровка Z-смещения.
* Вы всё ещё можете вручную настроить Z-смещение для различных видов нитей.
* Побеждает температурные колебания.
* Температурные колебания изменяют Z-смещение, но не меняют диапазон карты высоты с использованием датчика BD, что означает, что карта высоты остаётся одинаковой даже при разной температуре.

:::info Подсказка
Код данной функции находится в списке pull request официального репозитория Marlin GitHub: https://github.com/MarlinFirmware/Marlin/pull/27243
Поэтому используйте следующий код Marlin: https://github.com/markniu/MarlinPULL/tree/bugfix-2.1.x
:::

# Как использовать

Включите `BD_SENSOR` и добавьте в `configuration.h` строку `#define BD_SENSOR_CONTACT_PROBE`
Это должно выглядеть так:

``` bash
#define BD_SENSOR
#if ENABLED(BD_SENSOR)
  #define BD_SENSOR_PROBE_NO_STOP // Пробирование поверхности без остановки на каждом точке
  #define BD_SENSOR_CONTACT_PROBE // Использует датчик столкновения сопла во время homing
#endif
```

* В файле configuration.h увеличьте скорость датчика.

* Чувствительность зависит от скорости, поэтому вам нужно настроить скорость Z.
* Значения homing_speed (скорость homing) и second_homing_speed (вторичная скорость homing) должны быть в диапазоне от 3 до 10, здесь указывается скорость подачи по оси Z.
* Например:
``` bash
 #define Z_PROBE_FEEDRATE_FAST  (5*60)
 #define Z_PROBE_FEEDRATE_SLOW  (5*60)
```
* В файле Configuration_adv.h увеличьте подъём Z при homing до значения больше 4 мм.
``` bash
#define HOMING_BUMP_MM      { 5, 5, 5 }
```

# Тестирование homing
* Отправьте около 10 команд `G28 Z` или используйте команду `M48`, чтобы проверить его стабильность.

<Button variant="contained" disableElevation component="a" rel="noopener" href="https://www.youtube.com/watch?v=DzmGyJNS9bY">Видео демонстрация</Button>
