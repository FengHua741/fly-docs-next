## Как настроить z—offset
* Первый шаг: Используйте pursa/OrcaSlicer/cura/Bambu Studio для создания и печати 200x200 квадрата высотой 0.2 мм для настройки z—offset
* Второй шаг: Через IP принтера войдите в `fluidd` или `mainsail`, найдите панель управления `движение` для настройки z_OFFset, запомните настроенное значение
<ImageView image={require('@site/docs/DebugDoc/faq/img/Zoff.webp').default} size="80%" align="left" />
* Третий шаг: Перезапустите Klipper с помощью следующей команды
```bash
FIRMWARE_RESTART
```
* Четвертый шаг: Настройте z—offset с помощью следующей команды, открыв UI интерфейс, введите значение, которое вы настроили во время печати
```bash
G28
PROBE_EDDY_CURRENT_CALIBRATE CHIP=fly_eddy_probe
```
<ImageView image={require('@site/docs/DebugDoc/faq/img/UI.webp').default} size="50%" align="left" />

:::info
* Если вы получаете ошибку `Eddy current sensor error`, увеличьте значение z_offset в конфигурации eddy, смотрите пример

<ImageView image={require('@site/docs/DebugDoc/faq/img/EDDYZOFF.webp').default} size="50%" align="left" />
:::

## Инструкция по эксплуатации

    :::warning Важные заметки

    * Обратите внимание, что сначала нужно выполнить калибровку тока, а затем частоты катушки
    * Машины с несколькими осями Z требуют ручной выравнивания один раз после полной калибровки и повторного выравнивания
    * Версия прошивки нижнего уровня должна полностью соответствовать версии Kliiper

    :::

    :::info

    * Обратите внимание, что сначала нужно выполнить калибровку тока, а затем частоты катушки
    * Машины с несколькими осями Z требуют ручного выравнивания один раз после полной калибровки и повторного выравнивания
    * Версия прошивки нижнего уровня должна полностью соответствовать версии Kliiper

    :::

    * Добавьте следующую конфигурацию в веб-интерфейс `FUIDD` перед выполнением дальнейших действий
        ```cfg
        [force_move]
        enable_force_move: true
        ```

    ### Первый шаг: Калибровка EDDY тока

        * 1: Введите следующую команду в консоли
            ```bash
            SET_KINEMATIC_POSITION z=80
            ```
        * 2: Верните в исходное положение оси X и Y, переместите инструмент в центр стола
            ```bash
            G28 X Y
            ```
        * После выполнения этих шагов, необходимо откалибровать ток EDDY. Сначала переместите EDDY в центр стола, затем сопло должно едва касаться стола. Затем выполните следующую команду в консоли для автоматического получения значения тока, в конце сохраните параметры с помощью `SAVE_CONFIG`. Нормальное значение обратной связи около 15, если получаете 0 или 30, проверьте, правильно ли подключен (плохой контакт)
            ```bash
            LDC_CALIBRATE_DRIVE_CURRENT CHIP=fly_eddy_probe
            ```
        * Нормальное значение возврата должно быть около `15`
        * После калибровки сохраните параметры с помощью `SAVE_CONFIG`

    ### Второй шаг: Калибровка частоты Eddy

        :::info

        * При установке Eddy, его нижняя часть должна быть на 1-2 мм выше сопла
        * При калибровке частоты Eddy, катушка PCB должна быть на расстоянии не менее 5 мм от стола

        :::

        * Затем переместите сопло в центр платформы (обратите внимание: этот шаг должен выполняться без загрузки heightmap)
        * Начните ручную калибровку z-офсета [Paper test](https://www.klipper3d.org/Bed_Level.html#the-paper-test)
            ```bash
            PROBE_EDDY_CURRENT_CALIBRATE CHIP=fly_eddy_probe
            ```
        * После калибровки сохраните параметры с помощью `SAVE_CONFIG`
        :::info
        * Для принтеров с функцией `z_tilt` или `quad_gantry_level（QGL）`, сначала настройте параллельность `i3 настройте параллельность оси X, Trident настройте параллельность стола, Voron 2.4 настройте параллельность портала, затем откалибруйте частоту Eddy еще раз
        :::
    ### Третий шаг: Компенсация температуры

        * Верните все оси в исходное положение
       ```bash
       G28
       ```

        * Если у вас есть `[quad_gantry_level]` или `[z_tilt]`, сначала выполните `Z_TILT_ADJUST` или `QUAD_GANTRY_LEVEL`, затем верните все оси еще раз
        * Введите G0 Z5 в консоли или через веб-интерфейс, переместите ось Z на 5 мм над столом
        * Выполните следующий код, чтобы установить более длительный тайм-аут простоя, чтобы избежать тайм-аута во время нагрева
            ```bash
            SET_IDLE_TIMEOUT TIMEOUT=65000
            ```
        * Выполните следующую команду для начала калибровки
            ```bash
            TEMPERATURE_PROBE_CALIBRATE PROBE=fly_eddy_probe TARGET=56 STEP=4
            ```
        :::warning Важные заметки

        * Подсказка: В вышеуказанной команде, целевая температура для EDDy установлена на `56℃`, что подходит для большинства устройств.
        * Если температура в камере вашего 3D принтера выше, вы можете соответственно увеличить целевую температуру.
        * Обратите внимание, что чем выше целевая температура, тем дольше будет длиться калибровка, так как Eddy потребуется больше времени для достижения температурного равновесия.

        :::

        1. После выполнения этой команды, UI отобразит окно для настройки оси Z. Используйте упомянутый выше метод ручной настройки [Z-офсет (тест с бумагой)](https://www.klipper3d.org/Bed_Level.html#the-paper-test), зажмите бумагу между соплом и столом, затем подтвердите значение.
        2. После подтверждения значения, установите температуру стола на максимум, а температуру сопла на 220℃.
        3. Если вы находитесь в комнате с кондиционером или открытым окном, рекомендуется закрыть кондиционер или окно, чтобы обеспечить повышение температуры Eddy, так как ветер может влиять на нагрев.
        4. По мере повышения температуры Eddy, система будет автоматически предлагать вам каждые 4℃ выполнить ручную настройку Z-офсета. Температура стола очень высока, будьте осторожны, чтобы не обжечься!!!
        5. Повторите ручную настройку Z-офсета (тест с бумагой) до завершения калибровки. Если вы заметите, что температура Eddy больше не повышается, вы можете использовать следующие команды для досрочного завершения калибровки.
        
        * Дополнительные команды gcode во время калибровки дрейфа: TEMPERATURE_PROBE_NEXT
            * `TEMPERATURE_PROBE_NEXT`    Используется для принудительного сбора новых данных до достижения EDDy целевой температуры `56℃`.
            * `TEMPERATURE_PROBE_COMPLETE`    Используется для завершения калибровки до достижения EDDy целевой температуры `56℃`.
            * `ABORT`  Можно использовать для прерывания калибровки и игнорирования результатов.
        * После выполнения этих шагов, Eddy сможет обеспечить отличное качество первого слоя в широком диапазоне температур!
## Различные оптимизационные макросы

    ### `[quad_gantry_level]` оптимизация сканирования стола
        * Если у вас настроен `[quad_gantry_level]`, добавьте нижеприведенный макрос в конфигурацию, если нет - не нужно добавлять
        * Этот макрос будет уменьшать высоту сканирования по мере уменьшения разницы в высоте портала
            ```cfg
            [gcode_macro QUAD_GANTRY_LEVEL]
            rename_existing: _QUAD_GANTRY_LEVEL
            gcode:
                SAVE_GCODE_STATE NAME=STATE_QGL
                BED_MESH_CLEAR
                {% if not printer.quad_gantry_level.applied %}
                _QUAD_GANTRY_LEVEL horizontal_move_z=10 retry_tolerance=1
                {% endif %}
                _QUAD_GANTRY_LEVEL horizontal_move_z=2 METHOD=rapid_scan ADAPTIVE=1
                # G28 Z
                RESTORE_GCODE_STATE NAME=STATE_QGL
            ```

    ### `[z_tilt]` оптимизация сканирования стола

        * Если у вас настроен `[z_tilt]`, добавьте нижеприведенный макрос в конфигурацию, если нет - не нужно добавлять
        * Этот макрос будет уменьшать высоту сканирования по мере уменьшения разницы в высоте портала
            ```cfg
            [gcode_macro Z_TILT_ADJUST]
            rename_existing: _Z_TILT_ADJUST
            gcode:
                SAVE_GCODE_STATE NAME=STATE_Z_TILT
                BED_MESH_CLEAR
                {% if not printer.z_tilt.applied %}
                _Z_TILT_ADJUST horizontal_move_z=10 retry_tolerance=1
                {% endif %}
                _Z_TILT_ADJUST horizontal_move_z=2 METHOD=rapid_scan ADAPTIVE=1
                # G28 Z
                RESTORE_GCODE_STATE NAME=STATE_Z_TILT
            ```

    ### Оптимизация сканирования стола

        * Если вы используете мощный AC стол (более 500 Вт)
        * Нижеприведенный макрос отключает нагрев стола во время сканирования и вновь включает его после завершения
            ```cfg
            [gcode_macro BED_MESH_CALIBRATE]
            rename_existing: _BED_MESH_CALIBRATE
            gcode:
                {% set TARGET_TEMP = printer.heater_bed.target %}
                M140 S0
                _BED_MESH_CALIBRATE {rawparams}
                M140 S{TARGET_TEMP}
            ```
    ## Команды для настройки стола

        * Добавьте следующий макрос в файл конфигурации `printer.cfg`
            ```bash
            [gcode_macro BED_MESH_CALIBRATE]
             rename_existing: _BED_MESH_CALIBRATE
             gcode: 
                   _BED_MESH_CALIBRATE METHOD=rapid_scan {rawparams}
            ```
        * Команды для локального сканирования стола, убедитесь, что Klipper поддерживает функцию исключения объектов, рекомендуется добавить в стартовый макрос
            ```bash
            BED_MESH_CALIBRATE METHOD=rapid_scan adaptive=1 
            ```

## Ссылки для загрузки моделей катушек

        ```bash
        https://cdn.mellow.klipper.cn/STEP/sen.step
        https://cdn.mellow.klipper.cn/STEP/1612.step
        ```