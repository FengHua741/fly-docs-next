## Как настроить z—offset

* Первый шаг: Используйте pursa/OrcaSlicer/cura/Bambu Studio для нарезки квадрата 200x200 высотой 0.2 мм для печати и настройки z—offset
* Второй шаг: Войдите в `fluidd` `mainsail` через IP принтера, найдите панель управления `Движение` и настройте z_OFFset, затем запомните настроенное значение
<ImageView image={require('@site/docs/DebugDoc/faq/img/Zoff.webp').default} size="80%" align="left" />
* Третий шаг: Перезагрузите klippper с помощью следующей команды
```bash
FIRMWARE_RESTART
```
* Четвертый шаг: Настройте z—offset через следующие команды, в появившемся интерфейсе UI настройте значение `z—offset` на то же значение, что и при печати
```bash
G28
PROBE_EDDY_CURRENT_CALIBRATE CHIP=fly_eddy_probe
```
<ImageView image={require('@site/docs/DebugDoc/faq/img/UI.webp').default} size="50%" align="left" />

:::info
* Если появляется ошибка `Eddy current sensor error`, увеличьте значение z_offset в конфигурации eddy, смотрите пример

<ImageView image={require('@site/docs/DebugDoc/faq/img/EDDYZOFF.webp').default} size="50%" align="left" />
:::

:::info
 * Если после выполнения вышеуказанных действий сканирование платформы не удается, измените z-концевик на виртуальный.
:::

## Инструкции по работе

    :::warning Обратите внимание

    * Обратите внимание, что сначала нужно выполнить калибровку тока, а затем калибровку частоты катушки
    * Машины с несколькими осями Z требуют ручной выравнивания, после выполнения всех калибровок, еще раз выполните выравнивание и повторите калибровку
    * Версия прошивки нижнего уровня должна полностью соответствовать версии Kliiper

    :::

    :::info

    * Обратите внимание, что сначала нужно выполнить калибровку тока, а затем калибровку частоты катушки
    * Машины с несколькими осями Z требуют ручного выравнивания, после выполнения всех калибровок, еще раз выполните выравнивание и повторите калибровку
    * Версия прошивки нижнего уровня должна полностью соответствовать версии Kliiper

    :::

    * Добавьте конфигурацию ниже в веб-страницу `FUIDD` перед выполнением следующих действий
        ```cfg
        [force_move]
        enable_force_move: true
        ```

    ### Первый шаг: Калибровка тока EDDY

        * 1: Введите следующую команду в консоли
            ```bash
            SET_KINEMATIC_POSITION z=80
            ```
        * 2: Вернитесь в положение X и Y, переместите головку инструмента в центр платформы
            ```bash
            G28 X Y
            ```
        * После выполнения вышеуказанных шагов, необходимо откалибровать ток Eddy, сначала переместите EDDY в центр платформы, затем сопло должно едва касаться платформы. Затем в консоли выполните следующую команду для автоматического получения тока, затем `SAVE_CONFIG` для сохранения параметров. Нормальное значение обратной связи около 15, если 0 или 30, проверьте соединение (плохой контакт)
            ```bash
            LDC_CALIBRATE_DRIVE_CURRENT CHIP=fly_eddy_probe
            ```
        * Нормальное значение возврата должно быть около `15`
        * После завершения калибровки выполните `SAVE_CONFIG` для сохранения параметров

    ### Второй шаг: Калибровка частоты Eddy

        :::info

        * При установке Eddy, его нижняя часть должна быть как минимум на 1-2 мм выше сопла
        * При калибровке частоты Eddy, катушка PCB должна быть на расстоянии не менее 5 мм от платформы

        :::

        * Затем переместите сопло в центр платформы (Обратите внимание: этот шаг должен выполняться без загрузки heightmap)
        * Начните ручную калибровку z-отступа [Тест бумаги](https://www.klipper3d.org/Bed_Level.html#the-paper-test)
            ```bash
            PROBE_EDDY_CURRENT_CALIBRATE CHIP=fly_eddy_probe
            ```
        * После завершения калибровки выполните `SAVE_CONFIG` для сохранения параметров
        :::info
        * Для принтеров с функциями `z_tilt` или `quad_gantry_level（QGL）`, сначала настройте параллельность `i3 настройте параллельность оси X, трезубец настройте параллельность платформы, voron 2.4 настройте параллельность портала`, затем повторно откалибруйте частоту Eddy
        :::
    ### Третий шаг: Компенсация температуры

        * Верните все оси в исходное положение
       ```bash
       G28
       ```

        * Если у вас есть `[quad_gantry_level]` или `[z_tilt]`, сначала выполните `Z_TILT_ADJUST` или `QUAD_GANTRY_LEVEL`, затем снова верните оси в исходное положение
        * Введите в консоль G0 Z5 или переместите ось Z на 5 мм над платформой через веб-интерфейс
        * Выполните следующий код, чтобы установить `idle timeout` принтера подольше, чтобы избежать timeout во время нагрева
            ```bash
            SET_IDLE_TIMEOUT TIMEOUT=65000
            ```
        * Выполните следующую команду для начала калибровки
            ```bash
            TEMPERATURE_PROBE_CALIBRATE PROBE=fly_eddy_probe TARGET=56 STEP=4
            ```
        :::warning Обратите внимание

        * Совет: В вышеуказанной команде, целевая температура EDDy установлена на `56℃`, что подходит для большинства устройств.
        * Если фактическая температура в корпусе вашего 3D принтера выше, вы можете соответствующим образом повысить целевую температуру.
        * Имейте в виду, что чем выше целевая температура, тем больше времени потребуется для калибровки, так как Eddy потребуется больше времени для достижения температурного равновесия.

        :::
    
        1. После выполнения этой операции, на UI отобразится окно для настройки оси Z. Используйте упомянутый выше метод ручной калибровки смещения оси Z (тест с бумагой), зажмите бумагу между соплом и платформой, затем подтвердите это значение.
        2. После принятия значения, установите температуру платформы на максимум, температуру сопла на 220℃.
        3. Если вы находитесь в комнате с кондиционером или открытым окном, рекомендуется закрыть кондиционер или окно, чтобы обеспечить повышение температуры Eddy, так как ветер может влиять на повышение температуры.
        4. С повышением температуры Eddy, система будет автоматически просить вас выполнять ручную калибровку смещения оси Z каждые 4℃. Температура платформы очень высокая, будьте осторожны, чтобы не обжечься!!!
        5. Повторяйте ручную калибровку смещения оси Z (тест с бумагой) до завершения калибровки. Если обнаружите, что температура Eddy больше не повышается, вы можете использовать следующие команды для досрочного завершения калибровки.
        
        * В процессе калибровки дрейфа доступны дополнительные команды gcode, включая: TEMPERATURE_PROBE_NEXT
            * `TEMPERATURE_PROBE_NEXT`    для принудительного сбора новых данных Eddy до достижения установленной температуры `56℃`.
            * `TEMPERATURE_PROBE_COMPLETE`    для завершения калибровки до достижения Eddy установленной температуры `56℃`.
            * `ABORT`  для прерывания калибровки и игнорирования результатов.
        * После выполнения этих шагов, Eddy сможет обеспечивать отличное качество печати первого слоя в широком диапазоне температур!

## Различные оптимизирующие макросы

    ### Оптимизация сканирования платформы `[quad_gantry_level]`
        * Если у вас настроен `[quad_gantry_level]`, добавьте следующий макрос в конфигурацию, если нет, то добавлять не нужно
        * Этот макрос будет уменьшать высоту сканирования в зависимости от разницы высот портала
            ```cfg
            [gcode_macro QUAD_GANTRY_LEVEL]
            rename_existing: _QUAD_GANTRY_LEVEL
            gcode:
                SAVE_GCODE_STATE NAME=STATE_QGL
                BED_MESH_CLEAR
                {% if not printer.quad_gantry_level.applied %}
                _QUAD_GANTRY_LEVEL horizontal_move_z=10 retry_tolerance=1
                {% endif %}
                _QUAD_GANTRY_LEVEL horizontal_move_z=2 METHOD=rapid_scan ADAPTIVE=1
                # G28 Z
                RESTORE_GCODE_STATE NAME=STATE_QGL
            ```

    ### Оптимизация сканирования платформы `[z_tilt]`

        * Если у вас настроен `[z_tilt]`, добавьте следующий макрос в конфигурацию, если нет, то добавлять не нужно
        * Этот макрос будет уменьшать высоту сканирования в зависимости от разницы высот портала
            ```cfg
            [gcode_macro Z_TILT_ADJUST]
            rename_existing: _Z_TILT_ADJUST
            gcode:
                SAVE_GCODE_STATE NAME=STATE_Z_TILT
                BED_MESH_CLEAR
                {% if not printer.z_tilt.applied %}
                _Z_TILT_ADJUST horizontal_move_z=10 retry_tolerance=1
                {% endif %}
                _Z_TILT_ADJUST horizontal_move_z=2 METHOD=rapid_scan ADAPTIVE=1
                # G28 Z
                RESTORE_GCODE_STATE NAME=STATE_Z_TILT
            ```

    ### Оптимизация сканирования

        * Если используется мощная AC платформа (более 500 Вт)
        * Следующий макрос отключает нагрев платформы во время сканирования и снова включает его после завершения
            ```cfg
            [gcode_macro BED_MESH_CALIBRATE]
            rename_existing: _BED_MESH_CALIBRATE
            gcode:
                {% set TARGET_TEMP = printer.heater_bed.target %}
                M140 S0
                _BED_MESH_CALIBRATE {rawparams}
                M140 S{TARGET_TEMP}
            ```
    ## Команды сетки платформы
    
        * Добавьте следующий макрос в `printer.cfg`
            ```bash
            [gcode_macro BED_MESH_CALIBRATE]
             rename_existing: _BED_MESH_CALIBRATE
             gcode: 
                   _BED_MESH_CALIBRATE METHOD=rapid_scan {rawparams}
            ```
        * Команды для локальной сетки платформы, убедитесь, что Klipper может использовать функцию исключения объектов, рекомендуется добавить в начальный макрос
            ```bash
            BED_MESH_CALIBRATE METHOD=rapid_scan adaptive=1 
            ```

## Ссылки для скачивания моделей катушек

        ```bash
        https://cdn.mellow.klipper.cn/STEP/sen.step
        https://cdn.mellow.klipper.cn/STEP/1612.step
        ```