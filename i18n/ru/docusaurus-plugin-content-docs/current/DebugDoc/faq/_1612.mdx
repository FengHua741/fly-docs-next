## Как настроить z-offset

* Первый шаг: Используйте Prusa/OrcaSlicer/Cura/Bambu Studio для нарезки квадрата 200x200 высотой 0.2 мм для настройки z-offset.
* Второй шаг: Через IP-адрес принтера войдите в `fluidd` или `mainsail`, найдите панель управления, перемещение и контроль, настройте z-offset и запомните значение.
<ImageView image={require('@site/docs/DebugDoc/faq/img/Zoff.webp').default} size="80%" align="left" />
* Третий шаг: Перезагрузите klipper с помощью следующей команды:
```bash
FIRMWARE_RESTART
```
* Четвертый шаг: Настройте Z-offset через команду и интерфейс UI, значение будет таким же, как и при настройке во время печати:
```bash
G28
PROBE_EDDY_CURRENT_CALIBRATE CHIP=fly_eddy_probe
```
<ImageView image={require('@site/docs/DebugDoc/faq/img/UI.webp').default} size="50%" align="left" />

:::info
* Если появляется ошибка `Eddy current sensor error`, увеличьте значение z_offset в конфигурации eddy, см. рисунок.

<ImageView image={require('@site/docs/DebugDoc/faq/img/EDDYZOFF.webp').default} size="50%" align="left" />
:::

## Инструкции по использованию

    :::warning Внимание

    * Сначала выполните калибровку тока, затем калибровку частоты катушки.
    * Для принтеров с несколькими осями Z необходимо сначала вручную выровнять, выполнить все калибровки, затем снова выровнять и провести повторную калибровку.
    * Версия прошивки нижнего уровня должна полностью соответствовать версии Kliiper.

    :::

    :::info

    * Сначала выполните калибровку тока, затем калибровку частоты катушки.
    * Для принтеров с несколькими осями Z необходимо сначала вручную выровнять, выполнить все калибровки, затем снова выровнять и провести повторную калибровку.
    * Версия прошивки нижнего уровня должна полностью соответствовать версии Kliiper.

    :::

    * Добавьте следующую конфигурацию в веб-интерфейс `FUIDD` перед выполнением дальнейших действий:
        ```cfg
        [force_move]
        enable_force_move: true
        ```

    ### Шаг первый: Калибровка тока EDDY

        * 1: Введите следующую команду в консоли:
            ```bash
            SET_KINEMATIC_POSITION z=80
            ```
        * 2: Вернёте X и Y в начало координат и переместите инструмент в центр кровати:
            ```bash
            G28 X Y
            ```
        * После выполнения этих шагов, вам нужно откалибровать ток Eddy. Сначала переместите EDDY в центр кровати, затем слегка коснитесь кровати соплом. Затем выполните следующую команду в консоли для автоматического получения тока и сохраните параметры с помощью `SAVE_CONFIG`. Нормальное значение должно быть около `15`, если получается `0` или `30`, проверьте подключение (возможно, плохой контакт).
            ```bash
            LDC_CALIBRATE_DRIVE_CURRENT CHIP=fly_eddy_probe
            ```
        * Нормальное возвращаемое значение должно быть около `15`.
        * После завершения калибровки сохраните параметры с помощью `SAVE_CONFIG`.

    ### Шаг второй: Калибровка частоты Eddy

        :::info

        * При установке Eddy, его нижняя часть должна быть на 1-2 мм выше сопла.
        * При калибровке частоты Eddy, катушка PCB должна быть на расстоянии не менее 5 мм от кровати.

        :::

        * Затем переместите сопло в центр платформы (обратите внимание: на этом этапе убедитесь, что машина не загружает heightmap).
        * Начните ручную калибровку смещения z [Paper test](https://www.klipper3d.org/Bed_Level.html#the-paper-test).
            ```bash
            PROBE_EDDY_CURRENT_CALIBRATE CHIP=fly_eddy_probe
            ```
        * После завершения калибровки сохраните параметры с помощью `SAVE_CONFIG`.
        :::info
        * Для принтеров с функциями `z_tilt` или `quad_gantry_level（QGL）`, сначала отрегулируйте параллельность: для i3 отрегулируйте параллельность оси X, для трезубца отрегулируйте параллельность кровати, для Voron 2.4 отрегулируйте параллельность портала и снова откалибруйте частоту Eddy.
        :::
    ### Шаг третий: Компенсация температуры

        * Верните все оси в начальное положение:
       ```bash
       G28
       ```

        * Если у вас есть `[quad_gantry_level]` или `[z_tilt]`, сначала выполните `Z_TILT_ADJUST` или `QUAD_GANTRY_LEVEL`, затем вернитесь в начальное положение еще раз.
        * Введите в консоли G0 Z5 или переместите ось Z вверх на 5 мм через веб-интерфейс.
        * Выполните следующую команду для установки `idle timeout` на более долгий период, чтобы избежать timeout во время нагрева:
            ```bash
            SET_IDLE_TIMEOUT TIMEOUT=65000
            ```
        * Выполните следующую команду для начала калибровки:
            ```bash
            TEMPERATURE_PROBE_CALIBRATE PROBE=fly_eddy_probe TARGET=56 STEP=4
            ```
        :::warning Внимание

        * Примечание: В вышеуказанной команде целевая температура EDDY установлена на `56°C`, что подходит для большинства устройств.
        * Если фактическая температура в камере вашего 3D-принтера выше, вы можете соответствующим образом увеличить целевую температуру.
        * Обратите внимание, что чем выше целевая температура, тем дольше будет длиться калибровка, так как Eddy потребуется больше времени для достижения температурного равновесия.

        :::

        1. После выполнения этой операции на UI появится окно настройки Z-оси. Используйте упомянутый выше метод ручной калибровки смещения Z (Paper Test), зажмите бумагу между соплом и платформой, затем подтвердите значение.
        2. После принятия значения, установите температуру кровати на максимальную, а температуру сопла на 220°C.
        3. Если вы находитесь в помещении с кондиционером или открытыми окнами, рекомендуется выключить кондиционер или закрыть окна, чтобы обеспечить повышение температуры Eddy, так как ветер может повлиять на ее повышение.
        4. По мере повышения температуры Eddy, система будет автоматически предлагать вам выполнять ручную калибровку смещения Z каждые 4°C. Будьте осторожны, кровать очень горячая, опасность ожога!!!
        5. Повторяйте ручную калибровку смещения Z (Paper Test) до завершения калибровки. Если температура Eddy перестает расти, вы можете использовать следующие команды для досрочного завершения калибровки.

        * В процессе калибровки дрейфа доступны дополнительные команды gcode, включая: TEMPERATURE_PROBE_NEXT
            * `TEMPERATURE_PROBE_NEXT`    используется для принудительного сэмплирования новых данных Eddy до достижения целевой температуры `56°C`.
            * `TEMPERATURE_PROBE_COMPLETE`    используется для завершения калибровки, если Eddy не достигает установленной температуры `56°C`.
            * `ABORT`    используется для прерывания калибровки и игнорирования результатов.
        * После выполнения этих шагов Eddy сможет обеспечить отличное качество первого слоя печати в широком диапазоне температур.

## Различные оптимизированные макросы

    ### `[quad_gantry_level]` Оптимизация сканирования кровати
        * Если у вас есть настройка `[quad_gantry_level]`, добавьте следующий макрос в конфигурацию, если нет - не нужно добавлять.
        * Этот макрос будет уменьшать высоту сканирования с увеличением разницы высот портала.
            ```cfg
            [gcode_macro QUAD_GANTRY_LEVEL]
            rename_existing: _QUAD_GANTRY_LEVEL
            gcode:
                SAVE_GCODE_STATE NAME=STATE_QGL
                BED_MESH_CLEAR
                {% if not printer.quad_gantry_level.applied %}
                _QUAD_GANTRY_LEVEL horizontal_move_z=10 retry_tolerance=1
                {% endif %}
                _QUAD_GANTRY_LEVEL horizontal_move_z=2 METHOD=rapid_scan ADAPTIVE=1
                # G28 Z
                RESTORE_GCODE_STATE NAME=STATE_QGL
            ```

    ### `[z_tilt]` Оптимизация сканирования кровати

        * Если у вас есть настройка `[z_tilt]`, добавьте следующий макрос в конфигурацию, если нет - не нужно добавлять.
        * Этот макрос будет уменьшать высоту сканирования с увеличением разницы высот портала.
            ```cfg
            [gcode_macro Z_TILT_ADJUST]
            rename_existing: _Z_TILT_ADJUST
            gcode:
                SAVE_GCODE_STATE NAME=STATE_Z_TILT
                BED_MESH_CLEAR
                {% if not printer.z_tilt.applied %}
                _Z_TILT_ADJUST horizontal_move_z=10 retry_tolerance=1
                {% endif %}
                _Z_TILT_ADJUST horizontal_move_z=2 METHOD=rapid_scan ADAPTIVE=1
                # G28 Z
                RESTORE_GCODE_STATE NAME=STATE_Z_TILT
            ```

    ### Оптимизация сканирования кровати

        * Если вы используете мощную AC кровать (500 Вт и выше).
        * Этот макрос выключает кровать во время сканирования и снова нагревает после завершения.
            ```cfg
            [gcode_macro BED_MESH_CALIBRATE]
            rename_existing: _BED_MESH_CALIBRATE
            gcode:
                {% set TARGET_TEMP = printer.heater_bed.target %}
                M140 S0
                _BED_MESH_CALIBRATE {rawparams}
                M140 S{TARGET_TEMP}
            ```

## Команды сканирования кровати

        * Команда для сканирования всей кровати:
            ```bash
            BED_MESH_CALIBRATE METHOD=rapid_scan
            ```
        * Команда для сканирования локальной кровати, убедитесь, что Klipper может использовать функцию исключения объектов, рекомендуется добавить в макрос начала:
            ```bash
            BED_MESH_CALIBRATE METHOD=rapid_scan adaptive=1 
            ```

## Ссылки для загрузки моделей катушек

        ```bash
        https://cdn.mellow.klipper.cn/STEP/sen.step
        https://cdn.mellow.klipper.cn/STEP/1612.step
        ```