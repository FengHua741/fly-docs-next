## Как настроить z—offset
* Шаг первый: Используйте pursa/OrcaSlicer/cura/Bambu Studio для создания квадрата размером 200x200 и высотой 0.2 мм для печати и настройки z—offset
* Шаг второй: Перейдите по IP-адресу принтера к `fluidd` или `mainsail`, найдите панель управления и настройте смещение по оси Z, затем запомните значение настройки
<ImageView image={require('@site/docs/DebugDoc/faq/img/Zoff.webp').default} size="80%" align="left" />
* Шаг третий: Перезапустите Klipper следующей командой
```bash
FIRMWARE_RESTART
```
* Шаг четвертый: Настройте Z—offset с помощью следующих команд, появится UI интерфейс для настройки значения `z—offset`
```bash
G28
PROBE_EDDY_CURRENT_CALIBRATE CHIP=fly_eddy_probe
```
<ImageView image={require('@site/docs/DebugDoc/faq/img/UI.webp').default} size="50%" align="left" />

:::info
* Если вы получаете ошибку `Eddy current sensor error`, увеличьте значение z_offset в настройках eddy, смотрите пример на иллюстрации

<ImageView image={require('@site/docs/DebugDoc/faq/img/EDDYZOFF.webp').default} size="50%" align="left" />
:::

:::info
 * Если после выполнения всех вышеуказанных действий, сканирование кровати не удается, измените z-ограничитель на виртуальный
:::


## Руководство по выполнению

    :::warning Внимание

    * Обратите внимание, что сначала необходимо провести калибровку тока, а затем калибровку частоты катушки
    * Для машин с несколькими осями Z необходимо сначала провести ручную регулировку, затем выполнить все калибровки и снова провести регулировку
    * Версия прошивки нижнего уровня должна полностью соответствовать версии Klipper

    :::

    :::info

    * Обратите внимание, что сначала необходимо провести калибровку тока, а затем калибровку частоты катушки
    * Для машин с несколькими осями Z необходимо сначала провести ручную регулировку, затем выполнить все калибровки и снова провести регулировку
    * Версия прошивки нижнего уровня должна полностью соответствовать версии Klipper

    :::


    * Используйте веб-страницу `FUIDD` для добавления следующего конфигурационного файла перед выполнением следующих действий
        ```cfg
        [force_move]
        enable_force_move: true
        ```

    ### Шаг первый: Калибровка EDDY тока

        * 1: Введите следующую команду в консоли
            ```bash
            SET_KINEMATIC_POSITION z=80
            ```
        * 2: Выполните гоминг по осям X и Y, переместите головку инструмента в центр кровати
            ```bash
            G28 X Y
            ```
        * После выполнения вышеуказанных шагов, необходимо откалибровать ток Eddy, сначала переместите EDDY в центр кровати, чтобы сопло едва касалось кровати. Затем в консоли выполните следующую команду для автоматического получения тока, в конце `SAVE_CONFIG` сохраните параметры. Нормальное значение обратной связи составляет около 15, если значение равно 0 или 30, проверьте правильность подключения (плохой контакт)
            ```bash
            LDC_CALIBRATE_DRIVE_CURRENT CHIP=fly_eddy_probe
            ```
        * Нормальное значение обратной связи должно быть около `15`
        * После калибровки `SAVE_CONFIG` сохраните параметры

    ### Шаг второй: Калибровка частоты Eddy


        :::info

        * При установке Eddy, его положение относительно сопла должно быть на 1-2 мм выше сопла
        * При калибровке частоты Eddy, катушка PCB должна быть на расстоянии не менее 5 мм от кровати

        :::

        * Затем переместите сопло в центр платформы (обратите внимание: убедитесь, что машина не загружена heightmap)
        * Начните ручную калибровку z-оффсета [Paper test](https://www.klipper3d.org/Bed_Level.html#the-paper-test)
            ```bash
            PROBE_EDDY_CURRENT_CALIBRATE CHIP=fly_eddy_probe
            ```
        * После завершения калибровки `SAVE_CONFIG` сохраните параметры
        :::info
        * Для принтеров с функцией `z_tilt` или `quad_gantry_level（QGL）`, сначала настройте параллельность `i3 настройте параллельность оси X, трезубец настройте параллельность кровати voron 2.4 настройте параллельность портала перед повторной калибровкой частоты Eddy
        :::
    ### Шаг третий: Компенсация температуры

        * Выполните гоминг по всем осям
       ```bash
       G28
       ```

        * Если у вас есть `[quad_gantry_level]` или `[z_tilt]`, сначала выполните `Z_TILT_ADJUST` или `QUAD_GANTRY_LEVEL`, затем снова выполните гоминг
        * Введите в консоль G0 Z5 или через веб-интерфейс переместите ось Z на 5 мм выше кровати
        * Выполните следующую команду для установки `idle timeout` на более длительное время, чтобы избежать тайм-аута во время нагрева
            ```bash
            SET_IDLE_TIMEOUT TIMEOUT=65000
            ```
        * Выполните следующую команду для начала калибровки
            ```bash
            TEMPERATURE_PROBE_CALIBRATE PROBE=fly_eddy_probe TARGET=56 STEP=4
            ```
        :::warning Внимание

        * Подсказка: в вышеуказанной команде целевая температура EDDy установлена на `56℃`, что подходит для большинства устройств.
        * Если фактическая температура в камере вашего 3D-принтера выше, вы можете соответственно увеличить целевую температуру.
        * Обратите внимание, что чем выше целевая температура, тем больше времени потребуется для калибровки, так как Eddy будет дольше достигать температурного равновесия.

        :::
    
        1. После выполнения этой операции, UI покажет окно настройки оси Z. Используйте вышеупомянутый метод ручной настройки [Z-оффсета (Paper Test)](https://www.klipper3d.org/Bed_Level.html#the-paper-test), зажав бумагу между соплом и кроватью, затем подтвердите значение.
        2. После принятия значения, установите температуру кровати на максимум, а температуру сопла на 220℃.
        3. Если вы находитесь в помещении с кондиционером или открытыми окнами, для обеспечения повышения температуры Eddy, рекомендуется закрыть кондиционер или окна, так как ветер может повлиять на нагрев.
        4. По мере повышения температуры Eddy, система будет автоматически предлагать вам каждые 4℃ выполнять ручную настройку Z-оффсета. Температура кровати очень высока, будьте осторожны, чтобы избежать ожогов!!!
        5. Повторяйте ручную настройку Z-оффсета (Paper Test), пока калибровка не будет завершена. Если вы заметите, что температура Eddy больше не повышается, вы можете использовать следующие команды для досрочного завершения калибровки.
        
        * Дополнительные команды gcode, доступные во время калибровки дрейфа: TEMPERATURE_PROBE_NEXT
            * `TEMPERATURE_PROBE_NEXT`    Используется для принудительного получения новых данных от EDDy до достижения целевой температуры `56℃`.
            * `TEMPERATURE_PROBE_COMPLETE`    Используется для завершения калибровки до достижения EDDy целевой температуры `56℃`.
            * `ABORT`  Можно использовать для прекращения калибровки и игнорирования результатов.
        * После выполнения этих шагов, Eddy сможет обеспечить отличное качество первого слоя печати в широком диапазоне температур.
## Оптимизация различных макросов

    ### Оптимизация сканирования кровати `[quad_gantry_level]`
        * Если у вас настроен `[quad_gantry_level]`, добавьте следующий макрос в конфигурацию, если нет, то добавлять не нужно
        * Этот макрос будет уменьшать высоту зондирования по мере уменьшения разницы высот портала
            ```cfg
            [gcode_macro QUAD_GANTRY_LEVEL]
            rename_existing: _QUAD_GANTRY_LEVEL
            gcode:
                SAVE_GCODE_STATE NAME=STATE_QGL
                BED_MESH_CLEAR
                {% if not printer.quad_gantry_level.applied %}
                _QUAD_GANTRY_LEVEL horizontal_move_z=10 retry_tolerance=1
                {% endif %}
                _QUAD_GANTRY_LEVEL horizontal_move_z=2 METHOD=rapid_scan ADAPTIVE=1
                # G28 Z
                RESTORE_GCODE_STATE NAME=STATE_QGL
            ```

    ### Оптимизация сканирования кровати `[z_tilt]`

        * Если у вас настроен `[z_tilt]`, добавьте следующий макрос в конфигурацию, если нет, то добавлять не нужно
        * Этот макрос будет уменьшать высоту зондирования по мере уменьшения разницы высот портала
            ```cfg
            [gcode_macro Z_TILT_ADJUST]
            rename_existing: _Z_TILT_ADJUST
            gcode:
                SAVE_GCODE_STATE NAME=STATE_Z_TILT
                BED_MESH_CLEAR
                {% if not printer.z_tilt.applied %}
                _Z_TILT_ADJUST horizontal_move_z=10 retry_tolerance=1
                {% endif %}
                _Z_TILT_ADJUST horizontal_move_z=2 METHOD=rapid_scan ADAPTIVE=1
                # G28 Z
                RESTORE_GCODE_STATE NAME=STATE_Z_TILT
            ```

    ### Оптимизация сканирования кровати

        * Если вы используете мощную AC кровать (более 500 Вт)
        * Следующий макрос отключает кровать во время сканирования и снова нагревает её после завершения
            ```cfg
            [gcode_macro BED_MESH_CALIBRATE]
            rename_existing: _BED_MESH_CALIBRATE
            gcode:
                {% set TARGET_TEMP = printer.heater_bed.target %}
                M140 S0
                _BED_MESH_CALIBRATE {rawparams}
                M140 S{TARGET_TEMP}
            ```
    ## Команды сканирования кровати
    
        * В `printer.cfg` добавьте следующий макрос
            ```bash
            [gcode_macro BED_MESH_CALIBRATE]
             rename_existing: _BED_MESH_CALIBRATE
             gcode: 
                   _BED_MESH_CALIBRATE METHOD=rapid_scan {rawparams}
            ```
        * Команда для локального сканирования кровати, убедитесь, что Klipper может использовать функцию исключения объектов, рекомендуется добавить в начальный макрос
            ```bash
            BED_MESH_CALIBRATE METHOD=rapid_scan adaptive=1 
            ```

## Ссылки для загрузки модели катушки

        ```bash
        https://cdn.mellow.klipper.cn/STEP/sen.step
        https://cdn.mellow.klipper.cn/STEP/1612.step
        ```