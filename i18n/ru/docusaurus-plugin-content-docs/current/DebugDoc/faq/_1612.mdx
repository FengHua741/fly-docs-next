## Как настроить z-offset
* Первый шаг: Используйте pursa/OrcaSlicer/cura/Bambu Studio, чтобы нарезать квадрат размером 200x200 и высотой 0.2 мм для печати, чтобы настроить z-offset
* Второй шаг: Через IP принтера войдите в `fluidd` `mainsail`, найдите панель управления, в разделе "Передвижение" найдите настройку смещения по оси Z, чтобы продолжить настройку z-offset, и запомните настроенное значение
<ImageView image={require('@site/docs/DebugDoc/faq/img/Zoff.webp').default} size="80%" align="left" />
* Третий шаг: Перезагрузите klipper с помощью следующей команды
```bash
FIRMWARE_RESTART
```
* Четвертый шаг: Через следующие команды отрегулируйте Z-offset, появится UI интерфейс, где нужно ввести значение, настроенное во время печати
```bash
G28
PROBE_EDDY_CURRENT_CALIBRATE CHIP=fly_eddy_probe
```
<ImageView image={require('@site/docs/DebugDoc/faq/img/UI.webp').default} size="50%" align="left" />

:::info
* Если появляется ошибка `Eddy current sensor error`, увеличьте значение z_offset в настройках eddy, смотрите пример

<ImageView image={require('@site/docs/DebugDoc/faq/img/EDDYZOFF.webp').default} size="50%" align="left" />
:::

:::info
 * Если после выполнения вышеуказанных действий при попытке сканирования кровати происходит сбой, измените физический ограничитель Z на виртуальный
:::


## Инструкции по выполнению

    :::warning Важное замечание

    * Обратите внимание, что сначала необходимо выполнить калибровку тока, а затем калибровку частоты катушки
    * Для машин с несколькими осями Z необходимо провести ручное выравнивание один раз, выполнить все калибровки, затем снова выровнять и повторить калибровку
    * Версия прошивки контроллера должна полностью соответствовать версии Klipper

    :::

    :::info

    * Обратите внимание, что сначала необходимо выполнить калибровку тока, а затем калибровку частоты катушки
    * Для машин с несколькими осями Z необходимо провести ручное выравнивание один раз, выполнить все калибровки, затем снова выровнять и повторить калибровку
    * Версия прошивки контроллера должна полностью соответствовать версии Klipper

    :::


    * Пожалуйста, добавьте следующую конфигурацию на веб-страницу `FUIDD` перед выполнением последующих действий
        ```cfg
        [force_move]
        enable_force_move: true
        ```

    ### Шаг первый: Калибровка тока EDDY

        * 1: Введите следующую команду в консоли
            ```bash
            SET_KINEMATIC_POSITION z=80
            ```
        * 2: Верните X и Y на свои места и переместите головку инструмента в центр кровати
            ```bash
            G28 X Y
            ```
        * После выполнения вышеуказанных шагов необходимо калибровать ток Eddy, сначала переместите Eddy в центр кровати, затем сопло должно едва касаться кровати. Затем в консоли выполните следующую команду для автоматического получения тока и сохраните параметры с помощью `SAVE_CONFIG`. Нормальное значение должно быть около 15, если получен 0 или 30, проверьте подключение (плохой контакт)
            ```bash
            LDC_CALIBRATE_DRIVE_CURRENT CHIP=fly_eddy_probe
            ```
        * Нормальное значение должно быть около `15`
        * После завершения калибровки сохраните параметры с помощью `SAVE_CONFIG`

    ### Шаг второй: Калибровка частоты Eddy


        :::info

        * При установке Eddy, его нижняя часть должна находиться на 1-2 мм выше сопла
        * Во время калибровки частоты Eddy, катушка PCB должна быть удалена от кровати на расстояние не менее 5 мм

        :::

        * Затем переместите экструдер в центр платформы (обратите внимание: на этом этапе убедитесь, что машина не загрузила heightmap)
        * Начните ручную настройку z-отклонения [Тест с бумагой](https://www.klipper3d.org/Bed_Level.html#the-paper-test)
            ```bash
            PROBE_EDDY_CURRENT_CALIBRATE CHIP=fly_eddy_probe
            ```
        * После завершения калибровки сохраните параметры с помощью `SAVE_CONFIG`
        :::info
        * Принтеры с функцией `z_tilt` или `quad_gantry_level（QGL）`, сначала настройте параллельность `i3 настройте параллельность по оси X, Trident настройте параллельность кровати, Voron 2.4 настройте параллельность портала, затем повторно калибруйте частоту Eddy
        :::
    ### Шаг третий: Компенсация температуры

        * Верните все оси на свои места
       ```bash
       G28
       ```

        * Если у вас есть `[quad_gantry_level]` или `[z_tilt]`, сначала выполните `Z_TILT_ADJUST` или `QUAD_GANTRY_LEVEL`, а затем снова верните оси
        * Введите G0 Z5 в консоль или через веб-интерфейс переместите ось Z на 5 мм выше кровати
        * Выполните следующий код, чтобы установить более длительный `idle timeout`, чтобы избежать тайм-аута во время нагрева
            ```bash
            SET_IDLE_TIMEOUT TIMEOUT=65000
            ```
        * Выполните следующую команду для начала калибровки
            ```bash
            TEMPERATURE_PROBE_CALIBRATE PROBE=fly_eddy_probe TARGET=56 STEP=4
            ```
        :::warning Важное замечание

        * Подсказка: В вышеуказанной команде, целевая температура EDDY установлена на `56°C`, что подходит для большинства устройств.
        * Если фактическая температура камеры вашего 3D принтера выше, вы можете соответственно увеличить целевую температуру.
        * Обратите внимание, что чем выше целевая температура, тем дольше будет длиться калибровка, так как Eddy потребуется больше времени для достижения температурного равновесия.

        :::
    
        1. После выполнения этой операции на UI отобразится окно настройки оси Z. Используйте вышеупомянутый метод ручной настройки смещения Z (тест с бумагой), зажав бумагу между соплом и кроватью, и подтвердите это значение.
        2. После принятия значения, установите температуру кровати на максимум, температуру сопла на 220°C.
        3. Если вы находитесь в комнате с кондиционером или открытым окном, рекомендуется выключить кондиционер или окно, чтобы обеспечить повышение температуры Eddy, так как ветер может повлиять на нагрев.
        4. По мере повышения температуры Eddy, система будет автоматически подсказывать вам проводить ручную настройку смещения Z каждые 4°C. Будьте осторожны, кровать будет очень горячей, чтобы избежать ожогов!!!
        5. Повторяйте ручную настройку смещения Z (тест с бумагой), пока калибровка не будет завершена. Если температура Eddy перестает расти, вы можете использовать следующие команды, чтобы завершить калибровку досрочно.
        
        * В дополнение к основным командам для калибровки дрейфа доступны следующие gcode команды: TEMPERATURE_PROBE_NEXT
            * `TEMPERATURE_PROBE_NEXT`    Используется для принудительного сбора новых данных Eddy до достижения целевой температуры `56°C`.
            * `TEMPERATURE_PROBE_COMPLETE`    Используется для завершения калибровки до достижения Eddy установленной температуры `56°C`.
            * `ABORT`  Можно использовать для прерывания калибровки и игнорирования результатов.
        * После выполнения этих шагов, Eddy сможет обеспечить отличное качество первого слоя печати в широком диапазоне температур!
## Оптимизация различных макросов

    ### Оптимизация сканирования кровати `[quad_gantry_level]`
        * Если у вас настроен `[quad_gantry_level]`, вы можете добавить следующий макрос в конфигурацию, если нет, то добавлять не нужно
        * Этот макрос будет снижать высоту сканирования при уменьшении разницы высот портала
            ```cfg
            [gcode_macro QUAD_GANTRY_LEVEL]
            rename_existing: _QUAD_GANTRY_LEVEL
            gcode:
                SAVE_GCODE_STATE NAME=STATE_QGL
                BED_MESH_CLEAR
                {% if not printer.quad_gantry_level.applied %}
                _QUAD_GANTRY_LEVEL horizontal_move_z=10 retry_tolerance=1
                {% endif %}
                _QUAD_GANTRY_LEVEL horizontal_move_z=2 METHOD=rapid_scan ADAPTIVE=1
                # G28 Z
                RESTORE_GCODE_STATE NAME=STATE_QGL
            ```

    ### Оптимизация сканирования кровати `[z_tilt]`

        * Если у вас настроен `[z_tilt]`, вы можете добавить следующий макрос в конфигурацию, если нет, то добавлять не нужно
        * Этот макрос будет снижать высоту сканирования при уменьшении разницы высот портала
            ```cfg
            [gcode_macro Z_TILT_ADJUST]
            rename_existing: _Z_TILT_ADJUST
            gcode:
                SAVE_GCODE_STATE NAME=STATE_Z_TILT
                BED_MESH_CLEAR
                {% if not printer.z_tilt.applied %}
                _Z_TILT_ADJUST horizontal_move_z=10 retry_tolerance=1
                {% endif %}
                _Z_TILT_ADJUST horizontal_move_z=2 METHOD=rapid_scan ADAPTIVE=1
                # G28 Z
                RESTORE_GCODE_STATE NAME=STATE_Z_TILT
            ```

    ### Оптимизация сканирования кровати

        * Если вы используете мощную AC кровать (более 500W)
        * Следующий макрос отключает нагрев кровати во время сканирования и снова включает его после завершения
            ```cfg
            [gcode_macro BED_MESH_CALIBRATE]
            rename_existing: _BED_MESH_CALIBRATE
            gcode:
                {% set TARGET_TEMP = printer.heater_bed.target %}
                M140 S0
                _BED_MESH_CALIBRATE {rawparams}
                M140 S{TARGET_TEMP}
            ```
    ## Команды для сетки кровати
    
        * В `printer.cfg` добавьте следующий макрос
            ```bash
            [gcode_macro BED_MESH_CALIBRATE]
             rename_existing: _BED_MESH_CALIBRATE
             gcode: 
                   _BED_MESH_CALIBRATE METHOD=rapid_scan {rawparams}
            ```
        * Команда для локальной сетки кровати, убедитесь, что Klipper может использовать функцию исключения объектов, рекомендуется добавить в макрос начала печати
            ```bash
            BED_MESH_CALIBRATE METHOD=rapid_scan adaptive=1 
            ```

## Ссылки для загрузки моделей катушек

        ```bash
        https://cdn.mellow.klipper.cn/STEP/sen.step
        https://cdn.mellow.klipper.cn/STEP/1612.step
        ```