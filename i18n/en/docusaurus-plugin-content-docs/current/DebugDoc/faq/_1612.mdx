## How to Fine-Tune Z-Offset

* Step 1: Use Prusa/OrcaSlicer/Cura/Bambu Studio to slice a 200x200 square piece with a height of 0.2mm to print and fine-tune the Z-offset.
* Step 2: Enter `fluidd` or `mainsail` via the printer's IP, locate the dashboard `Move Control`, and continue to fine-tune the Z-offset, then remember the adjustment value.
<ImageView image={require('@site/docs/DebugDoc/faq/img/Zoff.webp').default} size="80%" align="left" />
* Step 3: Restart Klipper with the following command:
```bash
FIRMWARE_RESTART
```
* Step 4: Adjust the Z-offset through the UI interface that pops up with the following commands. The adjustment value should be the same as the one set during printing:
```bash
G28
PROBE_EDDY_CURRENT_CALIBRATE CHIP=fly_eddy_probe
```
<ImageView image={require('@site/docs/DebugDoc/faq/img/UI.webp').default} size="50%" align="left" />

:::info
* If you encounter the error `Eddy current sensor error`, increase the `z_offset` value in the eddy configuration, refer to the diagram.

<ImageView image={require('@site/docs/DebugDoc/faq/img/EDDYZOFF.webp').default} size="50%" align="left" />
:::

## Operation Instructions

    :::warning Precautions

    * Please perform current calibration before coil frequency calibration.
    * For multi-Z axis machines, manually level once, perform all calibrations, then level again before recalibrating.
    * The firmware of the lower-level machine must be exactly the same as the Kliiper version.

    :::

    :::info

    * Please perform current calibration before coil frequency calibration.
    * For multi-Z axis machines, manually level once, perform all calibrations, then level again before recalibrating.
    * The firmware of the lower-level machine must be exactly the same as the Kliiper version.

    :::

    * Please add the following configuration to the `FLUIDD` web page before proceeding with the operations below:
        ```cfg
        [force_move]
        enable_force_move: true
        ```

    ### Step 1: Calibrate EDDY Current

        * 1: Enter the following command in the console:
            ```bash
            SET_KINEMATIC_POSITION z=80
            ```
        * 2: Home X and Y, move the toolhead to the center of the bed:
            ```bash
            G28 X Y
            ```
        * After completing the above steps, you need to calibrate the Eddy current. First, move Eddy to the center of the bed, then let the nozzle just touch the bed. Then execute the following command in the console to automatically get the current, and finally `SAVE_CONFIG` to save the parameters. A feedback value around 15 is normal; feedback of 0 or 30 indicates a need to check if it's properly connected (poor contact).
            ```bash
            LDC_CALIBRATE_DRIVE_CURRENT CHIP=fly_eddy_probe
            ```
        * The normal return value should be around `15`.
        * After calibration, `SAVE_CONFIG` to save the parameters.

    ### Step 2: Calibrate Eddy Frequency

        :::info

        * When installing Eddy, the bottom should be at least 1-2 mm above the nozzle.
        * When calibrating Eddy frequency, the coil PCB should be at least 5mm away from the bed.

        :::

        * Then move the nozzle to the center of the platform (note: ensure the machine does not have a heightmap loaded at this step).
        * Start the manual Z offset calibration [Paper Test](https://www.klipper3d.org/Bed_Level.html#the-paper-test):
            ```bash
            PROBE_EDDY_CURRENT_CALIBRATE CHIP=fly_eddy_probe
            ```
        * After calibration, `SAVE_CONFIG` to save the parameters.
        :::info
        * For printers with `z_tilt` or `quad_gantry_level (QGL)`, first adjust the parallelism (`i3 adjusts the X-axis parallelism, Trident adjusts bed parallelism, Voron 2.4 adjusts gantry parallelism`), then calibrate the Eddy frequency again.
        :::
    ### Step 3: Temperature Compensation

        * Home all axes:
        ```bash
        G28
        ```

        * If there is `[quad_gantry_level]` or `[z_tilt]`, run `Z_TILT_ADJUST` or `QUAD_GANTRY_LEVEL` once, then home again.
        * Enter G0 Z5 in the console or move the Z-axis 5mm above the bed via the web interface.
        * Execute the following code to set the machine's `idle timeout` longer, avoiding timeout during heating:
            ```bash
            SET_IDLE_TIMEOUT TIMEOUT=65000
            ```
        * Start calibration with the following command:
            ```bash
            TEMPERATURE_PROBE_CALIBRATE PROBE=fly_eddy_probe TARGET=56 STEP=4
            ```
        :::warning Precautions

        * Note: In the above command, the EDDY target temperature is set to `56℃`, suitable for most devices.
        * If the actual temperature of your 3D printer chamber is higher, you can appropriately increase the target temperature.
        * Please note that the higher the target temperature, the longer the calibration will take, as Eddy needs more time to reach thermal equilibrium.

        :::

        1. After executing this operation, the UI will display the Z-axis adjustment box. Use the manual [Z-axis offset calibration (Paper Test) method](https://www.klipper3d.org/Bed_Level.html#the-paper-test) mentioned above, place the paper between the nozzle and the bed, then confirm the value.
        2. After accepting the value, set the bed temperature to the maximum, and the nozzle temperature to 220℃.
        3. If you are in a room with air conditioning or open windows, it's recommended to turn off the air conditioning or close the windows to ensure Eddy's temperature rises, as wind can affect the temperature increase.
        4. As Eddy's temperature rises, the system will automatically prompt you to perform a manual Z offset calibration every 4℃. Be careful not to burn yourself as the bed temperature is very high!!!
        5. Repeat the manual Z offset calibration (Paper Test) until the calibration is complete. If Eddy's temperature does not rise further, you can use the following related commands to end the calibration prematurely.

        * Additional G-code commands available during drift calibration include: TEMPERATURE_PROBE_NEXT
            * `TEMPERATURE_PROBE_NEXT`    Forces Eddy to sample new data before reaching the set target temperature of `56℃`.
            * `TEMPERATURE_PROBE_COMPLETE`    Completes calibration before Eddy reaches the set temperature of `56℃`.
            * `ABORT`  Can be used to terminate calibration and ignore results.
        * After completing these steps, Eddy will be able to provide excellent first-layer printing results across a wide range of temperatures!
## Various Optimization Macros

    ### `[quad_gantry_level]` Bed Leveling Optimization
        * If you have configured `[quad_gantry_level]`, add the following macro to the configuration. If not, there's no need to add it.
        * This macro reduces the probing height as the gantry height difference decreases:
            ```cfg
            [gcode_macro QUAD_GANTRY_LEVEL]
            rename_existing: _QUAD_GANTRY_LEVEL
            gcode:
                SAVE_GCODE_STATE NAME=STATE_QGL
                BED_MESH_CLEAR
                {% if not printer.quad_gantry_level.applied %}
                _QUAD_GANTRY_LEVEL horizontal_move_z=10 retry_tolerance=1
                {% endif %}
                _QUAD_GANTRY_LEVEL horizontal_move_z=2 METHOD=rapid_scan ADAPTIVE=1
                # G28 Z
                RESTORE_GCODE_STATE NAME=STATE_QGL
            ```

    ### `[z_tilt]` Bed Leveling Optimization

        * If you have configured `[z_tilt]`, add the following macro to the configuration. If not, there's no need to add it.
        * This macro reduces the probing height as the gantry height difference decreases:
            ```cfg
            [gcode_macro Z_TILT_ADJUST]
            rename_existing: _Z_TILT_ADJUST
            gcode:
                SAVE_GCODE_STATE NAME=STATE_Z_TILT
                BED_MESH_CLEAR
                {% if not printer.z_tilt.applied %}
                _Z_TILT_ADJUST horizontal_move_z=10 retry_tolerance=1
                {% endif %}
                _Z_TILT_ADJUST horizontal_move_z=2 METHOD=rapid_scan ADAPTIVE=1
                # G28 Z
                RESTORE_GCODE_STATE NAME=STATE_Z_TILT
            ```

    ### Bed Leveling Optimization

        * If using a high-power AC bed (over 500W)
        * The following macro turns off the bed during leveling and reheats it after completion:
            ```cfg
            [gcode_macro BED_MESH_CALIBRATE]
            rename_existing: _BED_MESH_CALIBRATE
            gcode:
                {% set TARGET_TEMP = printer.heater_bed.target %}
                M140 S0
                _BED_MESH_CALIBRATE {rawparams}
                M140 S{TARGET_TEMP}
            ```
    ## Bed Mesh Commands

        * Command to scan the entire bed:
            ```bash
            BED_MESH_CALIBRATE METHOD=rapid_scan
            ```
        * Local bed mesh command, ensure Klipper can use object exclusion, recommended to add to start macro:
            ```bash
            BED_MESH_CALIBRATE METHOD=rapid_scan adaptive=1 
            ```

## Coil Model Download Links

        ```bash
        https://cdn.mellow.klipper.cn/STEP/sen.step
        https://cdn.mellow.klipper.cn/STEP/1612.step
        ```