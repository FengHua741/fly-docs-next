---
sidebar_position: 3
sidebar_label: USB桥接CAN固件烧录
---

import CANFLASH from '@site/docs/General/dfu-flash/_host-can-flash.mdx';
import MakeOperate from "/docs/General/klipper-make/_make-operate.mdx";
import CAN from '@site/docs/General/dfu-flash/_firmware/072/_utoc.mdx';
import SSH from '@site/docs/General/dfu-flash/_firmware/_ssh.mdx';

import LS from '@site/docs/General/dfu-flash/_usb.mdx';
import CANBOOT from '@site/docs/General/dfu-flash/_host-katapult-flash.mdx';

# USB桥接CAN固件烧录

## 开始编译

    <SSH />

    <MakeOperate/>

    <CAN />

    * 按 `Q` 键，出现 **Save configuration**，这时再按 `Y` 键
        <ImageView image={require('@site/docs/General/dfu-flash/img/configuration.webp').default} size="40%" align="center" />
    * 现在应该保存了配置并且退出到了命令行界面
    * 输入 `make -j4` 开始编译，时间有点长
        <ImageView image={require('@site/docs/General/dfu-flash/img/make.webp').default} size="50%" align="center" />
    * 最后输出下面的内容则编译成功

        ```bash
        Linking out/klipper.elf
        Creating hex file out/klipper.bin
        ```

## 进入烧录模式

    :::tip 提示
        在2024年9月1号之后出厂的D5已经刷好Katapult固件
    :::
    * 使用TypeC数据线将主板连接至上位机后，**双击rerset按钮**，此时主板上会有LED灯闪烁。
    :::warning 警告
       * 如果没有LED灯闪烁，请重新烧录katapult固件：<Button variant="contained" disableElevation href="/docs/ProductDoc/MainBoard/fly-d/fly-d5/flash/bl#进入dfu烧录模式">烧录katapult固件</Button>
       * 如果没有LED灯闪烁，请在烧录完katapult固件后，再执行下一步
    :::
    <ImageView image={require('@site/docs/ProductDoc/MainBoard/fly-d/fly-d5/flash/img/d5_dfu.webp').default} size="100%" align="center" />

## 确认是否进入烧录模式

    * 请确保上位机可以正常联网，并确保下位机连接上位机的数据线具有数据传输功能。
    * SSH连接连接到上位机后输入`lsusb`并且回车，如果出现下方图片中圈起来的信息，就可以进行下一步。
        * 如果没有任何信息反馈，这是上位机的系统问题，这边无能为力，你需要更换确定正常的系统或者更换上位机。
        * 提示没有`lsusb`指令，可以执行此命令安装
            ```bash
            sudo apt-get install usbutils
            ```
            <ImageView image={require('@site/docs/General/get-id/img/6177.webp').default} size="80%" align="left" /> 
    * 红色框内显示的id可以做参考`但id不是固定的id是可变的`，`OpenMoko, Inc. stm32f072xx`后缀具有判断依据`XX`的意思是可变的。
        * 部分上位机可能因为系统问题，显示不全或者不显示。

## 演示视频

import React, { useState } from 'react';

export function VideoTabs() {
    const videos = [
        {
            label: '中文安装视频',
            icon: '📺',
            content: (
                <div style={{ position: 'relative', paddingBottom: '56.25%', height: 0, overflow: 'hidden', marginBottom: '2em' }}>
                    <iframe
                        src="//player.bilibili.com/player.html?isOutside=true&aid=114471632703606&bvid=BV1Ae5Tz5EiX&cid=29851322356&p=1"
                        title="D5 CAN固件烧录"
                        allow="autoplay; fullscreen; accelerometer; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowFullScreen
                        style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', border: 'none' }}
                    />
                </div>
            ),
        },
        {
            label: 'Installation video in English',
            icon: '📺',
            content: (
                <div style={{ position: 'relative', paddingBottom: '56.25%', height: 0, overflow: 'hidden' }}>
                    <iframe
                        width="560"
                        height="315"
                        src="https://www.youtube.com/embed/KS4iRlSnync?si=7_PtrExfBY-9uFO_"
                        title="D5 CAN firmware burning"
                        frameBorder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        referrerPolicy="strict-origin-when-cross-origin"
                        allowFullScreen
                        style={{ position: 'absolute', top: 0, left: 0, width: '100%', height: '100%', border: 'none' }}
                    />
                </div>
            ),
        },
    ];
    const [selected, setSelected] = useState(0);
    return (
        <div>
            <div style={{ marginBottom: '1em' }}>
                {videos.map((v, i) => (
                    <button
                        key={v.label}
                        onClick={() => setSelected(i)}
                        style={{
                            fontWeight: selected === i ? 'bold' : 'normal',
                            fontSize: '1em',
                            marginRight: 12,
                            padding: '0.5em 1em',
                            border: selected === i ? '2px solid #1976d2' : '1px solid #ccc',
                            background: selected === i ? '#e3f2fd' : '#fff',
                            borderRadius: 4,
                            cursor: 'pointer',
                        }}
                    >
                        {v.icon} {v.label}
                    </button>
                ))}
            </div>
            {videos[selected].content}
        </div>
    );
}

<VideoTabs />


## 烧录固件


    <CANBOOT />
